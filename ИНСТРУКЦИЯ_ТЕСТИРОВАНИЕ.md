# Полная инструкция по тестированию

## Этап 1: Локальное тестирование (на одной машине)

### 1.1. Сборка проекта

```bash
cd CW_HW_1
mvn clean package
```

После успешной сборки в папке `target/` появятся:
- `server.jar` - серверное приложение
- `client.jar` - клиентское приложение

### 1.2. Запуск сервера

Откройте первый терминал:

```bash
java -jar target/server.jar 8080
```

Вы должны увидеть:
```
Запуск сервера на порту 8080...
Сервер успешно запущен и ожидает подключений
IP адрес сервера: 127.0.0.1
```

### 1.3. Запуск клиента (тестовый режим)

Откройте второй терминал:

```bash
java -jar target/client.jar 127.0.0.1 8080 8 100 5
```

Параметры:
- `127.0.0.1` - localhost (ваша машина)
- `8080` - порт сервера
- `8` - N (шаг увеличения размера)
- `100` - M (количество итераций) - МАЛО для теста
- `5` - Q (под-итерации) - МАЛО для теста

Клиент должен:
1. Подключиться к серверу
2. Начать отправку данных
3. Показывать прогресс
4. Создать CSV файл `results_N8_M100_Q5.csv`

### 1.4. Проверка результатов

```bash
cat results_N8_M100_Q5.csv
```

Вы должны увидеть таблицу:
```
Размер (байт),Среднее время (мс)
8,1
16,1
24,1
...
```

---

## Этап 2: Тестирование с WireShark

### 2.1. Запуск WireShark

1. Откройте WireShark
2. Выберите сетевой интерфейс (обычно `lo0` для localhost или `en0`/`eth0` для сети)
3. Нажмите **Start capturing**

### 2.2. Фильтрация пакетов

В строке фильтра введите:
```
tcp.port == 8080
```

Нажмите Enter.

### 2.3. Запуск теста

1. Запустите сервер (если еще не запущен)
2. Запустите клиент с небольшими параметрами:
   ```bash
   java -jar target/client.jar 127.0.0.1 8080 8 10 2
   ```

### 2.4. Анализ пакетов в WireShark

Вы должны увидеть:
- **SYN, SYN-ACK, ACK** - установка TCP соединения
- **PSH, ACK** - передача данных от клиента к серверу
- **PSH, ACK** - ответ сервера клиенту
- **FIN, ACK** - закрытие соединения

### 2.5. Скриншот для отчета

1. Найдите несколько пакетов с данными вашего приложения
2. Выделите их
3. Сделайте скриншот (можно через меню File → Export → Screenshot)
4. Сохраните как `wireshark_screenshot.png`

---

## Этап 3: Развертывание на удаленных машинах

### 3.1. Подготовка удаленной машины (сервер)

#### Вариант A: Использование VM из облака (предоставляется курсом)

1. Получите доступ к VM (IP, логин, пароль)
2. Подключитесь через SSH:
   ```bash
   ssh username@server_ip
   ```

3. Проверьте версию Java:
   ```bash
   java -version
   ```
   Должна быть Java 21 или выше.

4. Скопируйте server.jar на VM:
   ```bash
   # На вашей локальной машине:
   scp target/server.jar username@server_ip:~/
   ```

#### Вариант B: Использование собственного VPS/VDS

Аналогично варианту A.

### 3.2. Запуск сервера на удаленной машине

На удаленной машине:

```bash
java -Xms100M -Xmx200M -jar server.jar 8080
```

Параметры `-Xms100M -Xmx200M` ограничивают память (требование задания).

Запишите IP адрес сервера:
```bash
hostname -I
# или
ifconfig
# или (на Windows)
ipconfig
```

### 3.3. Проверка доступности сервера

На вашей локальной машине проверьте доступность:

```bash
ping server_ip
```

Если ping работает, проверьте порт:
```bash
telnet server_ip 8080
# или
nc -zv server_ip 8080
```

### 3.4. Мониторинг сервера

На удаленной машине откройте второй терминал:

```bash
htop
```

Или для мониторинга сети:
```bash
sudo nethogs
```

Сделайте скриншот во время работы приложения.

---

## Этап 4: Выполнение экспериментов

### 4.1. Сценарий 1 (маленькие пакеты)

На вашей локальной машине:

```bash
java -jar target/client.jar SERVER_IP 8080 8 5000 25
```

Замените `SERVER_IP` на реальный IP адрес сервера.

**Время выполнения:** примерно 10-20 минут (зависит от сети)

**Результат:** файл `results_N8_M5000_Q25.csv`

### 4.2. Сценарий 2 (большие пакеты)

```bash
java -jar target/client.jar SERVER_IP 8080 1024 5000 10
```

**Время выполнения:** примерно 15-30 минут

**Результат:** файл `results_N1024_M5000_Q10.csv`

### 4.3. Сценарий 3 (свои параметры)

Выберите свои параметры, например:

```bash
java -jar target/client.jar SERVER_IP 8080 64 3000 15
```

Или:
```bash
java -jar target/client.jar SERVER_IP 8080 256 2000 20
```

**Результат:** файл `results_N64_M3000_Q15.csv` (или другой)

---

## Этап 5: Сбор доказательств для отчета

### 5.1. IP адреса

На сервере:
```bash
hostname -I
# Запишите IP
```

На клиенте:
```bash
hostname -I  # Linux/Mac
ipconfig     # Windows
# Запишите IP
```

### 5.2. Traceroute

На клиенте выполните:
```bash
traceroute SERVER_IP  # Linux/Mac
tracert SERVER_IP     # Windows
```

Сделайте скриншот вывода.

### 5.3. WireShark на удаленном подключении

1. Запустите WireShark на клиенте
2. Фильтр: `ip.addr == SERVER_IP and tcp.port == 8080`
3. Запустите один из экспериментов
4. Сделайте скриншот пакетов

### 5.4. Мониторинг htop/nethogs

На сервере во время эксперимента:
```bash
htop
```

Сделайте скриншот, показывающий:
- Процесс Java
- Использование CPU
- Использование памяти
- Отсутствие других тяжелых процессов

---

## Этап 6: Построение графиков

### 6.1. Импорт в Excel

1. Откройте Excel
2. Файл → Открыть → выберите `results_N8_M5000_Q25.csv`
3. Данные разделятся на два столбца

### 6.2. Создание графика

1. Выделите оба столбца
2. Вставка → Точечная диаграмма → Точечная с гладкими кривыми
3. Настройте оси (см. ИНСТРУКЦИЯ_EXCEL.md)

### 6.3. Повторите для всех сценариев

Создайте 3 отдельных графика для каждого сценария.

### 6.4. Сохранение

Сохраните Excel файл как `Графики_Фамилия.xlsx`

---

## Этап 7: Написание отчета

### 7.1. Используйте шаблон

Откройте `ОТЧЕТ_ШАБЛОН.md` и заполните все разделы.

### 7.2. Вставьте скриншоты

- WireShark
- htop/nethogs
- Графики из Excel
- Traceroute

### 7.3. Опишите графики

Для каждого графика напишите 2-3 предложения:
- Что видно на графике
- Какая зависимость
- Интересные наблюдения

### 7.4. Сохраните как PDF

Файл → Сохранить как → PDF

Название: `Отчет_Фамилия.pdf`

---

## Этап 8: Подготовка архива для сдачи

### 8.1. Структура архива

Создайте папку с вашей фамилией:
```
Фамилия/
├── Отчет_Фамилия.pdf
├── Графики_Фамилия.xlsx
├── results_N8_M5000_Q25.csv
├── results_N1024_M5000_Q10.csv
├── results_N64_M3000_Q15.csv
├── screenshots/
│   ├── wireshark.png
│   ├── htop.png
│   └── traceroute.png
└── src/
    └── (ваш Maven проект без .idea и target)
```

### 8.2. Создание ZIP архива

```bash
zip -r Фамилия.zip Фамилия/
```

Или через GUI: правый клик → Сжать.

### 8.3. Проверка архива

Распакуйте архив в другую папку и убедитесь, что:
- Все файлы на месте
- PDF открывается
- Excel открывается
- CSV файлы читаются

---

## Частые проблемы и решения

### Проблема: "Connection refused"

**Решение:**
1. Проверьте, что сервер запущен
2. Проверьте правильность IP и порта
3. Проверьте firewall на сервере:
   ```bash
   sudo ufw allow 8080
   ```

### Проблема: Очень долгое выполнение

**Решение:**
1. Уменьшите M или Q для теста
2. Проверьте скорость сети
3. Убедитесь, что сервер не перегружен

### Проблема: OutOfMemoryError

**Решение:**
1. Увеличьте память для клиента:
   ```bash
   java -Xmx512M -jar client.jar ...
   ```

### Проблема: CSV файл не создается

**Решение:**
1. Проверьте права на запись в текущей директории
2. Запустите клиент из домашней директории

---

## Чек-лист перед сдачей

- [ ] Проект собирается без ошибок
- [ ] Сервер запускается на удаленной машине
- [ ] Клиент подключается к серверу
- [ ] Выполнены все 3 сценария
- [ ] Созданы CSV файлы
- [ ] Построены графики в Excel
- [ ] Сделаны скриншоты WireShark
- [ ] Сделаны скриншоты htop/nethogs
- [ ] Сделан traceroute
- [ ] Заполнен отчет
- [ ] Отчет сохранен в PDF
- [ ] Создан ZIP архив
- [ ] Архив проверен
- [ ] Архив загружен в Smart LMS